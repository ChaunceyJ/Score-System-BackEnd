# 项目说明文档

> 姜其升 1752058

[TOC]

## 项目简介

本项目是一个人员绩效管理系统，主要分为人员信息管理、 部门信息管理 、奖惩制度管理、报表下载等模块。主要功能有车间管理、小组管理、员工管理、工作管理、规章制度管理、奖惩记录等功能。

## 技术架构

- 前端：vue.js
- 后端：asp.net
- 数据库：mysql

asp.net提供Web API的与前端进行数据交互，采用Restful风格，规定特定的响应格式：

```json
{
"code":20000,
"data":{}
}
```

20000为正常返回，其余为错误返回，登陆采用token形式。之后每次请求是都将token携带在头部返回。

asp.net与数据库之间使用Entity Framework框架连接，使用数据库先行的方式自动生成实体。数据库连接使用ADO.net进行连接，并且配和线程池使用。

## 主要功能

### 登录

本项目账号为上级管理人员指派发放，因此只提供登录功能，不提供注册功能。

![截屏2020-06-27上午4.48.44](img/%E6%88%AA%E5%B1%8F2020-06-27%E4%B8%8A%E5%8D%884.48.44.png)

![截屏2020-06-27上午4.44.20](img/%E6%88%AA%E5%B1%8F2020-06-27%E4%B8%8A%E5%8D%884.44.20.png)

### 车间管理

![截屏2020-06-27上午4.45.05](img/%E6%88%AA%E5%B1%8F2020-06-27%E4%B8%8A%E5%8D%884.45.05.png)

![截屏2020-06-27上午4.45.08](img/%E6%88%AA%E5%B1%8F2020-06-27%E4%B8%8A%E5%8D%884.45.08.png)

### 小组管理

![截屏2020-06-27上午4.45.30](img/%E6%88%AA%E5%B1%8F2020-06-27%E4%B8%8A%E5%8D%884.45.30.png)

### 员工管理

![截屏2020-06-27上午4.46.06](img/%E6%88%AA%E5%B1%8F2020-06-27%E4%B8%8A%E5%8D%884.46.06.png)

### 工作管理

![截屏2020-06-27上午4.43.52](img/%E6%88%AA%E5%B1%8F2020-06-27%E4%B8%8A%E5%8D%884.43.52.png)

### 规章制度管理

![截屏2020-06-27上午4.46.14](img/%E6%88%AA%E5%B1%8F2020-06-27%E4%B8%8A%E5%8D%884.46.14.png)

### 奖惩管理

![截屏2020-06-27上午4.46.31](img/%E6%88%AA%E5%B1%8F2020-06-27%E4%B8%8A%E5%8D%884.46.31.png)

## 项目要求完成情况

1. 程序集：

   一共按照系统模块划分为5个程序集，分别是：AdminManage（管理员管理）、AreaManage（部门管理）、RewardManage（奖惩管理）、WorkerManage（工人管理）和Models（EF实体），其中Models为共享程序集。在asp.net框架下调用这5个程序集，提供服务。

2. 共享程序集

   Models（ADO.NET EF实体）。

3. 采用C++/CLI实现程序集

   登陆密码的加密存储。

4. 输出WIN32 DLL并实现互操作

   使用c++实现快速排序算法，加速需要排序的操作。

5. 实现COM组件

   用于比较字符串是否相同，判断用户名等字符串是否有重复的情况。

6. 多线程技术和线程池技术

   前端使用多线程技术实现同步；后端与数据库连接采用线程池的方式连接。

7. ASP.NET与ADO.NET

   使用ASP.NET提供Web API；使用ADO.NET进行数据库连接。

8. .NET其他技术

   实现API级别的权限控制。

## 项目亮点

- 后端通过token识别用户，token与用户信息分开获取保证用户信息的准确性。

- 前后端一同进行权限控制，实现多种细粒度的权限控制

  | 角色       | 权限     |          |          |                      |                      |                      |                      |              |              |                  |                  |                  |            |
  | ---------- | -------- | -------- | -------- | -------------------- | -------------------- | -------------------- | -------------------- | ------------ | ------------ | ---------------- | ---------------- | ---------------- | ---------- |
  | 查看条例   | 修改条例 | 查看工种 | 修改工种 | 查看车间及管理员信息 | 修改车间及管理员信息 | 查看小组及管理员信息 | 修改小组及管理员信息 | 查看小组成员 | 修改小组信息 | 查看人员奖惩记录 | 修改人员奖惩记录 | 审核人员奖惩记录 |            |
  | 总管理员   | ✔️        | ✔️        | ✔️        | ✔️                    | ✔️                    | ✔️                    | ✔️                    |              | ✔️            |                  | ✔️                |                  | ✔️          |
  | 车间管理员 | ✔️        |          | ✔️        |                      | ✔️                    |                      | ✔️                    | ✔️            | 仅限本车间   |                  | 仅限本车间       |                  | 仅限本车间 |
  | 小组管理员 | ✔️        |          | ✔️        |                      | ✔️                    |                      | ✔️                    |              | 仅限本组     | 仅限本组         | 仅限本组         | 仅限本组         |            |

- 查询结果，表格Excel导出

## 碰到的难题与解决

### 跨域请求问题

安装CORS NeGet包。

```powershell
Install-Package Microsoft.AspNet.WebApi.Cors
```

全部Web API控制器启用CORS。

```c#
public static class WebApiConfig
{
    public static void Register(HttpConfiguration config)
    {
        var cors = new EnableCorsAttribute("www.example.com", "*", "*");
        config.EnableCors(cors);
        // ...
    }
}
```

### 后端无法直接通过IP访问

以管理员身份打开，在IIS服务器的设置上绑定IP地址。

### 权限控制问题

后端：通过继承```AuthorizeAttribute```类，重写```OnAuthorization```方法实现。

前端：[vue-element-admin](https://panjiachen.gitee.io/vue-element-admin-site/zh/)自带方式实现。





